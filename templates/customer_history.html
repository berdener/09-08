{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2>Müşteri Geçmişi: {{ customer.name }}</h2>

    <div class="alert alert-warning">
        <strong>Borç (Açık Veresiye):</strong> {{ open_credit | round(2) }} ₺
    </div>

    <hr>

    <h4>Satışlar</h4>
    {% if sales %}
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Tarih</th>
                    <th>Tutar</th>
                    <th>Ödeme Tipi</th>
                    <th>Durum</th>
                </tr>
            </thead>
            <tbody>
                {% for sale in sales %}
                <tr>
                    <td>{{ sale.sale_date }}</td>
                    <td>{{ sale.total_amount }} ₺</td>
                    <td>{{ sale.payment_type }}</td>
                    <td>
                        {% if sale.payment_type == "Veresiye" and sale.is_paid == 0 %}
                            <span class="badge bg-danger">Borç</span>
                        {% else %}
                            <span class="badge bg-success">Ödendi</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Satış bulunamadı.</p>
    {% endif %}

    <hr>

    <h4>İadeler</h4>
    {% if returns %}
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Tarih</th>
                    <th>Tutar</th>
                    <th>Detay</th>
                </tr>
            </thead>
            <tbody>
                {% for r in returns %}
                <tr>
                    <td>{{ r.return_date }}</td>
                    <td>{{ r.total_amount }} ₺</td>
                    <td>{{ r.details }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>İade bulunamadı.</p>
    {% endif %}

    <a href="{{ url_for('customer') }}" class="btn btn-secondary mt-3">Geri</a>
</div>
{% endblock %}
